<!--Ë°åÁ®ãPKÈ°µÈù¢-->
<view class="strategy-pk-container">
  <!-- ÂØºËà™Ê†è -->
  <view class="nav-bar">
    <view class="nav-left" bindtap="goBack">
      <text class="back-icon">‚Äπ</text>
    </view>
    <view class="nav-title">Ë°åÁ®ãPK</view>
  </view>

  <!-- Ê†áÁ≠æÈ°µÂØºËà™ -->
  <view class="tab-nav">
    <view class="tab-item {{currentTab === 0 ? 'active' : ''}}" bindtap="switchTab" data-index="0">
      <text>Âü∫Êú¨‰ø°ÊÅØ</text>
      <view class="tab-underline" wx:if="{{currentTab === 0}}"></view>
    </view>
    <view class="tab-item {{currentTab === 1 ? 'active' : ''}}" bindtap="switchTab" data-index="1">
      <text>Â∑ÆÂºÇÁÇπ</text>
      <view class="tab-underline" wx:if="{{currentTab === 1}}"></view>
    </view>
    <view class="tab-item {{currentTab === 2 ? 'active' : ''}}" bindtap="switchTab" data-index="2">
      <text>AIËûçÂêà</text>
      <view class="tab-underline" wx:if="{{currentTab === 2}}"></view>
    </view>
  </view>

  <!-- ÂÜÖÂÆπÂå∫Âüü -->
  <scroll-view class="content-area" scroll-y="true" refresher-enabled="true" refresher-triggered="{{refresherTriggered}}" bindrefresherrefresh="onRefresherRefresh" show-scrollbar="false">
    <!-- Âü∫Êú¨‰ø°ÊÅØÈ°µÈù¢ -->
    <view wx:if="{{currentTab === 0}}" class="basic-info-content">
      
      <!-- Áªü‰∏ÄÁöÑÂ∑¶Âè≥Â∏ÉÂ±ÄÂÆπÂô® -->
      <view class="unified-layout-container">
        <!-- Â∑¶‰æßÂõ∫ÂÆöÂÆπÂô® - ÂåÖÂê´ÊâÄÊúâÊ†áÈ¢òÂíåÊ†áÁ≠æ -->
        <view class="left-fixed-container">
          <!-- Â∑≤ÊúâÊñπÊ°àÊ†áÈ¢ò -->
          <view class="section-header-item section-header-existing-plans">
            <text class="section-title">Â∑≤ÊúâÊñπÊ°à</text>
          </view>
          
          <!-- ÊñπÊ°à‰∫ÆÁÇπÊ†áÈ¢ò -->
          <view class="section-header-item section-header-highlights">
            <text class="section-title">ÊñπÊ°à‰∫ÆÁÇπ</text>
          </view>
          
          <!-- È¢ÑÁÆó‰ª∑Ê†ºÊ†áÈ¢ò -->
          <view class="section-header-item section-header-budget">
            <text class="section-title">È¢ÑÁÆó‰ª∑Ê†º</text>
            <view class="arrow-icon">‚ñº</view>
          </view>
          
          <!-- È¢ÑÁÆó‰ª∑Ê†ºÊ†áÁ≠æÁªÑ -->
          <view class="labels-group budget-labels">
            <view class="label-item budget-label-item">
              <text>ÊÄª‰ª∑</text>
            </view>
            <view class="label-item budget-label-item">
              <text>È§êÈ•ÆÈ¢ÑÁÆó</text>
            </view>
            <view class="label-item budget-label-item">
              <text>ÈÖíÂ∫óÈ¢ÑÁÆó</text>
            </view>
          </view>
          
          <!-- Áã¨ÂÆ∂‰ΩìÈ™åÊ†áÈ¢ò -->
          <view class="section-header-item section-header-exclusive">
            <text class="section-title">Áã¨ÂÆ∂‰ΩìÈ™å</text>
            <view class="arrow-icon">‚ñº</view>
          </view>
          
          <!-- Áã¨ÂÆ∂‰ΩìÈ™åÊ†áÁ≠æÁªÑ -->
          <view class="labels-group exclusive-labels">
            <view class="label-item exclusive-label-item">
              <text>ÁâπËâ≤‰ΩìÈ™å</text>
            </view>
            <view class="label-item exclusive-label-item">
              <text>ÁâπËâ≤ÁæéÈ£ü</text>
            </view>
            <view class="label-item exclusive-label-item">
              <text>ÁâπËâ≤‰∫§ÈÄö</text>
            </view>
          </view>
          
          <!-- ‰ΩèÂÆø‰ΩçÁΩÆÊ†áÈ¢ò -->
          <view class="section-header-item section-header-accommodation">
            <text class="section-title">‰ΩèÂÆø‰ΩçÁΩÆ</text>
            <view class="arrow-icon">‚ñº</view>
          </view>
          
          <!-- ‰ΩèÂÆø‰ΩçÁΩÆÊ†áÁ≠æÁªÑ -->
          <view class="labels-group accommodation-labels">
            <view class="label-item accommodation-label-item">
              <text>‰ΩçÁΩÆ</text>
            </view>
            <view class="label-item accommodation-label-item">
              <text>Êó∂Èó¥</text>
            </view>
          </view>
          
          <!-- ‰∫§ÈÄöÊñπÂºèÊ†áÈ¢ò -->
          <view class="section-header-item section-header-transportation">
            <text class="section-title">‰∫§ÈÄöÊñπÂºè</text>
            <view class="arrow-icon">‚ñº</view>
          </view>
          
          <!-- ‰∫§ÈÄöÊñπÂºèÊ†áÁ≠æÁªÑ -->
          <view class="labels-group transportation-labels">
            <view class="label-item transportation-label-item">
              <text>‰∏ª‰∫§ÈÄö</text>
            </view>
            <view class="label-item transportation-label-item">
              <text>Â∏ÇÂå∫ÂÜÖ</text>
            </view>
          </view>
        </view>
        
        <!-- Âè≥‰æßÊªöÂä®ÂÆπÂô® - ÂåÖÂê´ÊâÄÊúâÊñπÊ°àÊï∞ÊçÆ -->
        <scroll-view class="right-scrollable-container" scroll-x="true" show-scrollbar="false" enhanced="true">
          <view class="all-plans-data">
            <!-- Âõõ‰∏™ÊñπÊ°àÂàó -->
            <view class="plan-data-column" wx:for="{{existingPlans}}" wx:key="id" wx:for-index="planIndex">
              
              <!-- Â∑≤ÊúâÊñπÊ°àÂç°Áâá -->
              <view class="plan-section-data plan-section-existing-plans">
                <view class="plan-card">
                  <view class="plan-content">
                    <view class="plan-status">
                      <view class="status-badge {{item.voted ? 'voted' : 'not-voted'}}">
                        <text class="check-icon">‚úì</text>
                        <text>{{item.voted ? 'Â∑≤ÊäïÁ•®' : 'Êú™ÊäïÁ•®'}}</text>
                      </view>
                    </view>
                    <view class="main-content">
                      <view class="title-row">
                        <view class="plan-icon">
                          <text class="icon-text">{{item.iconText}}</text>
                        </view>
                        <view class="plan-title">{{item.title}}</view>
                      </view>
                      <view class="plan-subtitle">{{item.subtitle}}</view>
                    </view>
                    <view class="vote-section">
                      <view class="avatar-badge">
                        <image class="avatar-img" src="{{item.avatar}}" mode="aspectFill"></image>
                      </view>
                      <view class="vote-btn {{item.voted ? 'voted' : ''}}" bindtap="toggleVote" data-id="{{item.id}}">
                        <text class="vote-icon">{{item.voted ? '‚úì' : 'üëç'}}</text>
                        <text class="vote-text {{item.voted ? 'voted-text' : 'not-voted-text'}}">{{item.voted ? 'Â∑≤ÊäïÁ•®' : 'ÁÇπÊ≠§ÊäïÁ•®'}}</text>
                      </view>
                    </view>
                  </view>
                </view>
              </view>
              
              <!-- ÊñπÊ°à‰∫ÆÁÇπÊï∞ÊçÆ -->
              <view class="plan-section-data plan-section-highlights">
                <view class="highlight-card">
                  <view class="highlight-content">{{planHighlights[planIndex].content}}</view>
                  <view class="highlight-tags">
                    <view class="tag" wx:for="{{planHighlights[planIndex].tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</view>
                  </view>
                </view>
              </view>
              
              <!-- È¢ÑÁÆó‰ª∑Ê†ºÊï∞ÊçÆ -->
              <view class="plan-section-data budget-data plan-section-budget">
                <view class="budget-value-container">
                  <view class="data-cells-group budget-data-cells">
                    <!-- ÊÄª‰ª∑Ë°å -->
                    <view class="data-cell budget-data-cell">
                      <text>{{budgetItems[0].values[planIndex] || '-'}}</text>
                    </view>
                    <!-- È§êÈ•ÆÈ¢ÑÁÆóË°å -->
                    <view class="data-cell budget-data-cell">
                      <text>{{budgetItems[1].values[planIndex] || '-'}}</text>
                    </view>
                    <!-- ÈÖíÂ∫óÈ¢ÑÁÆóË°å -->
                    <view class="data-cell budget-data-cell">
                      <text>{{budgetItems[2].values[planIndex] || '-'}}</text>
                    </view>
                  </view>
                </view>
              </view>
              
              <!-- Áã¨ÂÆ∂‰ΩìÈ™åÊï∞ÊçÆ -->
              <view class="plan-section-data exclusive-data plan-section-exclusive">
                <view class="exclusive-value-container">
                  <view class="data-cells-group exclusive-data-cells">
                    <!-- ÁâπËâ≤‰ΩìÈ™åË°å -->
                    <view class="data-cell exclusive-data-cell">
                      <text>{{exclusiveItems[0].values[planIndex] || '-'}}</text>
                    </view>
                    <!-- ÁâπËâ≤ÁæéÈ£üË°å -->
                    <view class="data-cell exclusive-data-cell">
                      <text>{{exclusiveItems[1].values[planIndex] || '-'}}</text>
                    </view>
                    <!-- ÁâπËâ≤‰∫§ÈÄöË°å -->
                    <view class="data-cell exclusive-data-cell">
                      <text>{{exclusiveItems[2].values[planIndex] || '-'}}</text>
                    </view>
                  </view>
                </view>
              </view>
              
              <!-- ‰ΩèÂÆø‰ΩçÁΩÆÊï∞ÊçÆ -->
              <view class="plan-section-data accommodation-data plan-section-accommodation">
                <view class="accommodation-value-container">
                  <view class="data-cells-group accommodation-data-cells">
                    <!-- ‰ΩçÁΩÆË°å -->
                    <view class="data-cell accommodation-data-cell">
                      <text>{{accommodationItems[0].values[planIndex] || '-'}}</text>
                    </view>
                    <!-- Êó∂Èó¥Ë°å -->
                    <view class="data-cell accommodation-data-cell">
                      <text>{{accommodationItems[1].values[planIndex] || '-'}}</text>
                    </view>
                  </view>
                </view>
              </view>
              
              <!-- ‰∫§ÈÄöÊñπÂºèÊï∞ÊçÆ -->
              <view class="plan-section-data transportation-data plan-section-transportation">
                <view class="transportation-value-container">
                  <view class="data-cells-group transportation-data-cells">
                    <!-- ‰∏ª‰∫§ÈÄöË°å -->
                    <view class="data-cell transportation-data-cell">
                      <text>{{transportationItems[0].values[planIndex] || '-'}}</text>
                    </view>
                    <!-- Â∏ÇÂå∫ÂÜÖË°å -->
                    <view class="data-cell transportation-data-cell">
                      <text>{{transportationItems[1].values[planIndex] || '-'}}</text>
                    </view>
                  </view>
                </view>
              </view>
              
            </view>
          </view>
        </scroll-view>
      </view>
      
    </view>

    <!-- Â∑ÆÂºÇÁÇπÈ°µÈù¢ -->
    <view wx:if="{{currentTab === 1}}" class="difference-content">
      
      <!-- Áªü‰∏ÄÁöÑÂ∑¶Âè≥Â∏ÉÂ±ÄÂÆπÂô® -->
      <view class="unified-layout-container">
        <!-- Â∑¶‰æßÂõ∫ÂÆöÂÆπÂô® - ÂåÖÂê´ÊâÄÊúâÊ†áÈ¢òÂíåÊ†áÁ≠æ -->
        <view class="left-fixed-container">
          <!-- Â∑≤ÊúâÊñπÊ°àÊ†áÈ¢ò -->
          <view class="section-header-item section-header-existing-plans">
            <text class="section-title">Â∑≤ÊúâÊñπÊ°à</text>
          </view>
          
          <!-- Ê†∏ÂøÉÂ∑ÆÂºÇÊ†áÈ¢ò -->
          <view class="section-header-item section-header-core-differences">
            <text class="section-title">Ê†∏ÂøÉÂ∑ÆÂºÇ</text>
            <view class="arrow-icon">‚ñº</view>
          </view>
          
          <!-- Ê†∏ÂøÉÂ∑ÆÂºÇÊ†áÁ≠æÁªÑ -->
          <view class="labels-group core-differences-labels">
            <view class="label-item core-differences-label-item">
              <text>Ê∂àË¥πÊÑüÂèó</text>
            </view>
            <view class="label-item core-differences-label-item">
              <text>Êó•ÂùáÈ¢ÑÁÆó</text>
            </view>
            <view class="label-item core-differences-label-item">
              <text>Ê∏∏Áé©‰ΩìÈ™å</text>
            </view>
            <view class="label-item core-differences-label-item">
              <text>Êó•ÂùáÊôØÁÇπ</text>
            </view>
            <view class="label-item core-differences-label-item">
              <text>Êó•ÂùáÊ≠•Êï∞</text>
            </view>
            <view class="label-item core-differences-label-item">
              <text>Êç¢ÈÖíÂ∫ó</text>
            </view>
          </view>
        </view>
        
        <!-- Âè≥‰æßÊªöÂä®ÂÆπÂô® - ÂåÖÂê´ÊâÄÊúâÊñπÊ°àÊï∞ÊçÆ -->
        <scroll-view class="right-scrollable-container" scroll-x="true" show-scrollbar="false" enhanced="true">
          <view class="all-plans-data">
            <!-- Âõõ‰∏™ÊñπÊ°àÂàó -->
            <view class="plan-data-column" wx:for="{{existingPlans}}" wx:key="id" wx:for-index="planIndex">
              
              <!-- Â∑≤ÊúâÊñπÊ°àÂç°Áâá -->
              <view class="plan-section-data plan-section-existing-plans">
                <view class="plan-card">
                  <view class="plan-content">
                    <view class="plan-status">
                      <view class="status-badge {{item.voted ? 'voted' : 'not-voted'}}">
                        <text class="check-icon">‚úì</text>
                        <text>{{item.voted ? 'Â∑≤ÊäïÁ•®' : 'Êú™ÊäïÁ•®'}}</text>
                      </view>
                    </view>
                    <view class="main-content">
                      <view class="title-row">
                        <view class="plan-icon">
                          <text class="icon-text">{{item.iconText}}</text>
                        </view>
                        <view class="plan-title">{{item.title}}</view>
                      </view>
                      <view class="plan-subtitle">{{item.subtitle}}</view>
                    </view>
                    <view class="vote-section">
                      <view class="avatar-badge">
                        <image class="avatar-img" src="{{item.avatar}}" mode="aspectFill"></image>
                      </view>
                      <view class="vote-btn {{item.voted ? 'voted' : ''}}" bindtap="toggleVote" data-id="{{item.id}}">
                        <text class="vote-icon">{{item.voted ? '‚úì' : 'üëç'}}</text>
                        <text class="vote-text {{item.voted ? 'voted-text' : 'not-voted-text'}}">{{item.voted ? 'Â∑≤ÊäïÁ•®' : 'ÁÇπÊ≠§ÊäïÁ•®'}}</text>
                      </view>
                    </view>
                  </view>
                </view>
              </view>
              
              <!-- Ê†∏ÂøÉÂ∑ÆÂºÇÊï∞ÊçÆ -->
              <view class="plan-section-data core-differences-data core-differences-plan-section">
                <view class="core-differences-value-container">
                  <view class="data-cells-group core-differences-data-cells">
                    <!-- Ê∂àË¥πÊÑüÂèóË°å -->
                    <view class="data-cell core-differences-data-cell">
                      <text>{{coreDifferences[0].values[planIndex] || '-'}}</text>
                    </view>
                    <!-- Êó•ÂùáÈ¢ÑÁÆóË°å -->
                    <view class="data-cell core-differences-data-cell">
                      <text>{{coreDifferences[1].values[planIndex] || '-'}}</text>
                    </view>
                    <!-- Ê∏∏Áé©‰ΩìÈ™åË°å -->
                    <view class="data-cell core-differences-data-cell">
                      <text>{{coreDifferences[2].values[planIndex] || '-'}}</text>
                    </view>
                    <!-- Êó•ÂùáÊôØÁÇπË°å -->
                    <view class="data-cell core-differences-data-cell">
                      <text>{{coreDifferences[3].values[planIndex] || '-'}}</text>
                    </view>
                    <!-- Êó•ÂùáÊ≠•Êï∞Ë°å -->
                    <view class="data-cell core-differences-data-cell">
                      <text>{{coreDifferences[4].values[planIndex] || '-'}}</text>
                    </view>
                    <!-- Êç¢ÈÖíÂ∫óË°å -->
                    <view class="data-cell core-differences-data-cell">
                      <text>{{coreDifferences[5].values[planIndex] || '-'}}</text>
                    </view>
                  </view>
                </view>
              </view>
              
            </view>
          </view>
        </scroll-view>
      </view>
      
    </view>

    <!-- AIËûçÂêàÈ°µÈù¢ -->
    <view wx:if="{{currentTab === 2}}" class="ai-fusion-content">
      <view class="ai-fusion-plans-grid four-plans">
        <view class="ai-fusion-plan-card" wx:for="{{existingPlans}}" wx:key="id">
          <view class="plan-status">
            <view class="status-badge {{item.voted ? 'voted' : 'not-voted'}}">
              <text class="check-icon">‚úì</text>
              <text>{{item.voted ? 'Â∑≤ÊäïÁ•®' : 'Êú™ÊäïÁ•®'}}</text>
            </view>
          </view>
          <view class="plan-content">
            <view class="title-row">
              <view class="plan-icon">
                <text class="icon-text">{{item.iconText}}</text>
              </view>
              <view class="plan-title">{{item.title}}</view>
            </view>
            <view class="plan-subtitle">{{item.subtitle}}</view>
            <view class="vote-section">
              <view class="avatar-badge">
                <image class="avatar-img" src="{{item.avatar}}" mode="aspectFill"></image>
              </view>
              <view class="vote-btn {{item.voted ? 'voted' : ''}}" bindtap="toggleVote" data-id="{{item.id}}">
                <text class="vote-icon">{{item.voted ? '‚úì' : 'üëç'}}</text>
                <text class="vote-text {{item.voted ? 'voted-text' : 'not-voted-text'}}">{{item.voted ? 'Â∑≤ÊäïÁ•®' : 'ÁÇπÊ≠§ÊäïÁ•®'}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- Â∫ïÈÉ®ÊåâÈíÆ -->
  <view class="bottom-actions" wx:if="{{currentTab !== 2}}">
    <view class="action-btn secondary" bindtap="downloadReport">
      <text>‰∏ãËΩΩÈ°µÈù¢ÂõæÁâá</text>
    </view>

    <button class="action-btn primary share-btn" open-type="share">
      <image class="share-icon" src="https://p0.meituan.net/hackathonqjj/8572dd552d155204f3f0e157b20532f4698.png" mode="aspectFit"></image>
      <text>ÂàÜ‰∫´ÂØπÊØîË°åÁ®ã</text>
    </button>
  </view>

  <!-- AIËûçÂêàÊåâÈíÆ - Âõ∫ÂÆöÂú®Â±èÂπïÂ∫ïÈÉ® -->
  <view class="ai-fusion-actions-fixed" wx:if="{{currentTab === 2}}">
    <!-- ÂëºÂî§ÈòüÈïøËß£ÈîÅËØ≠Èü≥Ê∞îÊ≥° -->
    <image class="captain-call-bubble" src="https://p0.meituan.net/hackathonqjj/20f4a5b781dcd7d81577d68ee48a47ca20888.png" mode="aspectFill"></image>
    
    <!-- AIËûçÂêàÂõæÁâáÊåâÈíÆ -->
    <image class="ai-fusion-image-btn" src="https://p0.meituan.net/hackathonqjj/516dfdc8dcfbbbc44d5b667aee88041e9472.png" mode="aspectFill" bindtap="generateFusionPlan"></image>
  </view>

  <!-- CanvasÁîªÂ∏É - Áî®‰∫éÁîüÊàêÂØπÊØîÂõæ -->
  <canvas 
    canvas-id="comparisonCanvas" 
    class="comparison-canvas"
    style="width: 900px; height: 1200px; position: fixed; top: -9999px; left: 0;"
  ></canvas>

  <!-- ÂéüÁîü Canvas - Áî®‰∫éÁîüÊàêÊï¥È°µÈïøÂõæ -->
  <canvas 
    type="2d"
    id="exportCanvas" 
    class="export-canvas"
    style="position: fixed; top: -9999px; left: 0; width: 750px; height: {{exportHeight || 1200}}px;"
  ></canvas>

  <!-- ÈöêËóèÁöÑ Canvas ÂÖÉÁ¥†ÔºåÁî®‰∫éÁîüÊàêÈ°µÈù¢Êà™Âõæ -->
  <canvas 
    type="2d"
    id="pageCanvas" 
    class="page-canvas"
    style="position: fixed; top: -9999px; left: -9999px; width: 750px; height: 1334px; z-index: -1;"
  ></canvas>

</view>
