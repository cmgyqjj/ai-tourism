<!--Ë°åÁ®ãPKÈ°µÈù¢-->
<view class="strategy-pk-container">
  <!-- ÂØºËà™Ê†è -->
  <view class="nav-bar">
    <view class="nav-left" bindtap="goBack">
      <text class="back-icon">‚Äπ</text>
    </view>
    <view class="nav-title">Ë°åÁ®ãPK</view>
  </view>

  <!-- Ê†áÁ≠æÈ°µÂØºËà™ -->
  <view class="tab-nav">
    <view class="tab-item {{currentTab === 0 ? 'active' : ''}}" bindtap="switchTab" data-index="0">
      <text>Âü∫Êú¨‰ø°ÊÅØ</text>
      <view class="tab-underline" wx:if="{{currentTab === 0}}"></view>
    </view>
    <view class="tab-item {{currentTab === 1 ? 'active' : ''}}" bindtap="switchTab" data-index="1">
      <text>Â∑ÆÂºÇÁÇπ</text>
      <view class="tab-underline" wx:if="{{currentTab === 1}}"></view>
    </view>
    <view class="tab-item {{currentTab === 2 ? 'active' : ''}}" bindtap="switchTab" data-index="2">
      <text>AIËûçÂêà</text>
      <view class="tab-underline" wx:if="{{currentTab === 2}}"></view>
    </view>
  </view>

  <!-- ÂÜÖÂÆπÂå∫Âüü -->
  <scroll-view class="content-area" scroll-y="true" refresher-enabled="true" refresher-triggered="{{refresherTriggered}}" bindrefresherrefresh="onRefresherRefresh" show-scrollbar="false">
    <!-- Âü∫Êú¨‰ø°ÊÅØÈ°µÈù¢ -->
    <view wx:if="{{currentTab === 0}}" class="basic-info-content">
      
      <!-- Â∑≤ÊúâÊñπÊ°à -->
      <view class="section existing-plans">
        <view class="header-container">
            <view class="section-title">Â∑≤ÊúâÊñπÊ°à</view>
            <scroll-view class="plans-container" scroll-x="true" show-scrollbar="false" enhanced="true" bindscroll="onPlansScroll">
                <view class="plans-wrapper {{layoutClass}}">
                <view class="plan-card" wx:for="{{existingPlans}}" wx:key="id">
                    <view class="plan-content">
                        <view class="plan-status">
                            <view class="status-badge {{item.voted ? 'voted' : 'not-voted'}}">
                                <text class="check-icon">‚úì</text>
                                <text>{{item.voted ? 'Â∑≤ÊäïÁ•®' : 'Êú™ÊäïÁ•®'}}</text>
                            </view>
                        </view>
                        <view class="main-content">
                            <view class="title-row">
                                <view class="plan-icon">
                                    <text class="icon-text">{{item.iconText}}</text>
                                </view>
                                <view class="plan-title">{{item.title}}</view>
                            </view>
                            <view class="plan-subtitle">{{item.subtitle}}</view>
                        </view>
                        <view class="vote-section">
                            <view class="avatar-badge">
                                <image class="avatar-img" src="{{item.avatar}}" mode="aspectFill"></image>
                            </view>
                            <view class="vote-btn {{item.voted ? 'voted' : ''}}" bindtap="toggleVote" data-id="{{item.id}}">
                                <text class="vote-icon">{{item.voted ? '‚úì' : 'üëç'}}</text>
                                <text>{{item.voted ? 'Â∑≤ÊäïÁ•®' : 'ÁÇπÊ≠§ÊäïÁ•®'}}</text>
                            </view>
                        </view>
                    </view>
                </view>
                </view>
            </scroll-view>
            </view>
      </view>

      <!-- ÊñπÊ°à‰∫ÆÁÇπ -->
      <view class="section plan-highlights">
  <view class="header-container">
    <view class="section-title">ÊñπÊ°à‰∫ÆÁÇπ</view>
    <scroll-view class="highlights-container" scroll-x="true" show-scrollbar="false" enhanced="true" bindscroll="onHighlightsScroll">
      <view class="highlights-wrapper">
        <view class="highlight-card" wx:for="{{planHighlights}}" wx:key="id">
          <view class="highlight-content">{{item.content}}</view>
          <view class="highlight-tags">
            <view class="tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
</view>


      <!-- È¢ÑÁÆó‰ª∑Ê†º -->
      <view class="section budget-section">
        <view class="section-header" bindtap="toggleBudget">
            <text class="section-title">È¢ÑÁÆó‰ª∑Ê†º</text>
            <view class="arrow-icon {{budgetExpanded ? 'expanded' : ''}}">‚ñº</view>
        </view>
        
        <!-- ÊéßÂà∂Â±ïÂºÄÂíåÊî∂Ëµ∑ -->
        <view class="budget-content {{budgetExpanded ? 'expanded' : 'collapsed'}}" style="{{budgetExpanded ? 'display:block' : 'display:none'}}">
            <view class="sync-scroll-layout">
                <view class="left-labels">
                    <view class="label-item" wx:for="{{budgetItems}}" wx:key="label">
                        <text>{{item.label}}</text>
                    </view>
                </view>
                <scroll-view class="right-data" scroll-x="true" show-scrollbar="false" enhanced="true" bindscroll="onBudgetScroll">
                    <view class="data-wrapper">
                        <view class="data-column" wx:for="{{existingPlans}}" wx:key="id" wx:for-index="planIndex">
                            <view class="data-cell" wx:for="{{budgetItems}}" wx:key="label">
                                <text>{{item.values[planIndex] || '-'}}</text>
                            </view>
                        </view>
                    </view>
                </scroll-view>
            </view>
        </view>
      </view>

      <!-- Áã¨ÂÆ∂‰ΩìÈ™å -->
      <view class="section exclusive-experience">
        <view class="section-header" bindtap="toggleExclusive">
          <text class="section-title">Áã¨ÂÆ∂‰ΩìÈ™å</text>
          <view class="arrow-icon {{exclusiveExpanded ? 'expanded' : ''}}">‚ñº</view>
        </view>
        <view class="exclusive-content {{exclusiveExpanded ? 'expanded' : 'collapsed'}}">
          <view class="sync-scroll-layout">
            <view class="left-labels">
              <view class="label-item" wx:for="{{exclusiveItems}}" wx:key="label">
                <text>{{item.label}}</text>
              </view>
            </view>
            <scroll-view class="right-data" scroll-x="true" show-scrollbar="false" enhanced="true" bindscroll="onExclusiveScroll">
              <view class="data-wrapper">
                <view class="data-column" wx:for="{{existingPlans}}" wx:key="id" wx:for-index="planIndex">
                  <view class="data-cell" wx:for="{{exclusiveItems}}" wx:key="label">
                    <text>{{item.values[planIndex] || '-'}}</text>
                  </view>
                </view>
              </view>
            </scroll-view>
          </view>
        </view>
      </view>

      <!-- ‰ΩèÂÆø‰ΩçÁΩÆ -->
      <view class="section accommodation">
        <view class="section-header" bindtap="toggleAccommodation">
          <text class="section-title">‰ΩèÂÆø‰ΩçÁΩÆ</text>
          <view class="arrow-icon {{accommodationExpanded ? 'expanded' : ''}}">‚ñº</view>
        </view>
        <view class="accommodation-content {{accommodationExpanded ? 'expanded' : 'collapsed'}}" style="{{accommodationExpanded ? 'display:block' : 'display:none'}}">
          <view class="sync-scroll-layout">
            <view class="left-labels">
              <view class="label-item" wx:for="{{accommodationItems}}" wx:key="label">
                <text>{{item.label}}</text>
              </view>
            </view>
            <scroll-view class="right-data" scroll-x="true" show-scrollbar="false" enhanced="true" bindscroll="onAccommodationScroll">
              <view class="data-wrapper">
                <view class="data-column" wx:for="{{existingPlans}}" wx:key="id" wx:for-index="planIndex">
                  <view class="data-cell" wx:for="{{accommodationItems}}" wx:key="label">
                    <text>{{item.values[planIndex] || '-'}}</text>
                  </view>
                </view>
              </view>
            </scroll-view>
          </view>
        </view>
      </view>

      <!-- ‰∫§ÈÄöÊñπÂºè -->
      <view class="section transportation">
        <view class="section-header" bindtap="toggleTransportation">
          <text class="section-title">‰∫§ÈÄöÊñπÂºè</text>
          <view class="arrow-icon {{transportationExpanded ? 'expanded' : ''}}">‚ñº</view>
        </view>
        <view class="transportation-content {{transportationExpanded ? 'expanded' : 'collapsed'}}" style="{{transportationExpanded ? 'display:block' : 'display:none'}}">
          <view class="sync-scroll-layout">
            <view class="left-labels">
              <view class="label-item" wx:for="{{transportationItems}}" wx:key="label">
                <text>{{item.label}}</text>
              </view>
            </view>
            <scroll-view class="right-data" scroll-x="true" show-scrollbar="false" enhanced="true" bindscroll="onTransportationScroll">
              <view class="data-wrapper">
                <view class="data-column" wx:for="{{existingPlans}}" wx:key="id" wx:for-index="planIndex">
                  <view class="data-cell" wx:for="{{transportationItems}}" wx:key="label">
                    <text>{{item.values[planIndex] || '-'}}</text>
                  </view>
                </view>
              </view>
            </scroll-view>
          </view>
        </view>
      </view>

    </view>

    <!-- Â∑ÆÂºÇÁÇπÈ°µÈù¢ -->
    <view wx:elif="{{currentTab === 1}}" class="difference-content">
      <!-- Â∑≤ÊúâÊñπÊ°à -->
      <view class="section existing-plans">
        <view class="header-container">
        <view class="section-title">Â∑≤ÊúâÊñπÊ°à</view>
        <scroll-view class="plans-container" scroll-x="true" show-scrollbar="false" enhanced="true" bindscroll="onPlansScroll">
          <view class="plans-wrapper {{layoutClass}}">
            <view class="plan-card" wx:for="{{existingPlans}}" wx:key="id">
              <view class="plan-content">
                <view class="plan-status">
                  <view class="status-badge {{item.voted ? 'voted' : 'not-voted'}}">
                    <text class="check-icon">‚úì</text>
                    <text>{{item.voted ? 'Â∑≤ÊäïÁ•®' : 'Êú™ÊäïÁ•®'}}</text>
                  </view>
                </view>
                <view class="main-content">
                  <view class="title-row">
                    <view class="plan-icon">
                      <text class="icon-text">{{item.iconText}}</text>
                    </view>
                    <view class="plan-title">{{item.title}}</view>
                  </view>
                  <view class="plan-subtitle">{{item.subtitle}}</view>
                </view>
                <view class="vote-section">
                  <view class="avatar-badge">
                    <image class="avatar-img" src="{{item.avatar}}" mode="aspectFill"></image>
                  </view>
                  <view class="vote-btn {{item.voted ? 'voted' : ''}}" bindtap="toggleVote" data-id="{{item.id}}">
                    <text class="vote-icon">{{item.voted ? '‚úì' : 'üëç'}}</text>
                    <text>{{item.voted ? 'Â∑≤ÊäïÁ•®' : 'ÁÇπÊ≠§ÊäïÁ•®'}}</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </scroll-view>
        </view>
      </view>

      <!-- Ê†∏ÂøÉÂ∑ÆÂºÇÂØπÊØî -->
      <view class="section core-differences-section">
        <view class="section-header" bindtap="toggleCoreDifferences">
          <text class="section-title">Ê†∏ÂøÉÂ∑ÆÂºÇ</text>
          <view class="arrow-icon {{coreDifferencesExpanded ? 'expanded' : ''}}">‚ñº</view>
        </view>
        
        <view class="core-differences-content {{coreDifferencesExpanded ? 'expanded' : 'collapsed'}}">
          <view class="sync-scroll-layout">
            <view class="left-labels">
              <view class="label-item" wx:for="{{coreDifferences}}" wx:key="label">
                <text>{{item.label}}</text>
              </view>
            </view>
            <scroll-view class="right-data" scroll-x="true" show-scrollbar="false" enhanced="true" bindscroll="onCoreDifferencesScroll">
              <view class="data-wrapper">
                <view class="data-column" wx:for="{{existingPlans}}" wx:key="id" wx:for-index="planIndex">
                  <view class="data-cell" wx:for="{{coreDifferences}}" wx:key="label">
                    <text>{{item.values[planIndex] || '-'}}</text>
                  </view>
                </view>
              </view>
            </scroll-view>
          </view>
        </view>
      </view>
    </view>

    <!-- AIËûçÂêàÈ°µÈù¢ -->
    <view wx:elif="{{currentTab === 2}}" class="ai-fusion-content">
      <view class="fusion-plans-grid {{layoutClass}}">
        <view class="fusion-plan-card" wx:for="{{existingPlans}}" wx:key="id">
          <view class="plan-status">
            <view class="status-badge {{item.voted ? 'voted' : 'not-voted'}}">
              <text class="check-icon">‚úì</text>
              <text>{{item.voted ? 'Â∑≤ÊäïÁ•®' : 'Êú™ÊäïÁ•®'}}</text>
            </view>
          </view>
          <view class="plan-content">
            <view class="title-row">
              <view class="plan-icon">
                <text class="icon-text">{{item.iconText}}</text>
              </view>
              <view class="plan-title">{{item.title}}</view>
            </view>
            <view class="plan-subtitle">{{item.subtitle}}</view>
            <view class="vote-section">
              <view class="avatar-badge">
                <image class="avatar-img" src="{{item.avatar}}" mode="aspectFill"></image>
              </view>
              <view class="vote-btn {{item.voted ? 'voted' : ''}}" bindtap="toggleVote" data-id="{{item.id}}">
                <text class="vote-icon">{{item.voted ? '‚úì' : 'üëç'}}</text>
                <text>{{item.voted ? 'Â∑≤ÊäïÁ•®' : 'ÁÇπÊ≠§ÊäïÁ•®'}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- Â∫ïÈÉ®ÊåâÈíÆ -->
  <view class="bottom-actions" wx:if="{{currentTab !== 2}}">
    <view class="action-btn secondary" bindtap="downloadReport">
      <text>‰∏ãËΩΩÂØπÊØîÊä•Âëä</text>
    </view>
    <view class="action-btn primary" bindtap="shareItinerary">
      <image class="share-icon" src="/images/upload.png" mode="aspectFit"></image>
      <text>ÂàÜ‰∫´ÂØπÊØîË°åÁ®ã</text>
    </view>
  </view>

  <!-- CanvasÁîªÂ∏É - Áî®‰∫éÁîüÊàêÂØπÊØîÂõæ -->
  <canvas 
    canvas-id="comparisonCanvas" 
    class="comparison-canvas"
    style="width: 600px; height: 800px; position: fixed; top: -9999px; left: 0;"
  ></canvas>

  <!-- AIËûçÂêàÊåâÈíÆ -->
  <view class="ai-fusion-actions" wx:if="{{currentTab === 2}}">
    <!-- ÂëºÂî§ÈòüÈïøËß£ÈîÅËØ≠Èü≥Ê∞îÊ≥° -->
    <image class="captain-call-bubble" src="/images/strategyPK/a.png" mode="aspectFill"></image>
    
    <view class="ai-fusion-btn" bindtap="generateFusionPlan">
      <image class="ai-fusion-bg" src="/images/strategyPK/btn.png" mode="aspectFill"></image>
      <view class="ai-fusion-content">
      
      </view>
    </view>
  </view>
</view>
