<!--trip-detail.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-left" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    <view class="nav-title">è¡Œç¨‹è¯¦æƒ…</view>
    <view class="nav-right">
      <button class="share-btn" open-type="share">
        <text class="share-icon">ğŸ“¤</text>
      </button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è¡Œç¨‹è¯¦æƒ…å†…å®¹ -->
  <view class="trip-content" wx:if="{{!isLoading && tripInfo}}">
    <!-- è¡Œç¨‹åŸºæœ¬ä¿¡æ¯ -->
    <view class="trip-header">
      <view class="destination-title">{{tripInfo.destination}}</view>
      <view class="trip-meta">
        <text class="duration">{{tripInfo.duration}}</text>
        <text class="date-range">{{tripInfo.startDate}} - {{tripInfo.endDate}}</text>
      </view>
      <view class="budget">é¢„ç®—ï¼š{{tripInfo.budget}}</view>
    </view>

    <!-- æ ‡ç­¾ -->
    <view class="tags-section">
      <view class="tag" wx:for="{{tripInfo.tags}}" wx:key="*this">
        <text>{{item}}</text>
      </view>
    </view>

    <!-- è¡Œç¨‹æè¿° -->
    <view class="description-section">
      <view class="section-title">è¡Œç¨‹æè¿°</view>
      <view class="description-text">{{tripInfo.description}}</view>
    </view>

    <!-- è¡Œç¨‹å®‰æ’ -->
    <view class="itinerary-section">
      <view class="section-title">è¡Œç¨‹å®‰æ’</view>
      <view class="itinerary-list">
        <view class="itinerary-item" wx:for="{{tripInfo.itinerary}}" wx:key="day">
          <view class="day-header">
            <text class="day-number">ç¬¬{{item.day}}å¤©</text>
            <text class="day-title">{{item.title}}</text>
          </view>
          <view class="activities">
            <text class="activity" wx:for="{{item.activities}}" wx:key="*this" wx:for-item="activity">{{activity}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æˆå‘˜ä¿¡æ¯ -->
    <view class="members-section">
      <view class="section-title">æˆå‘˜ä¿¡æ¯ ({{tripInfo.currentCompanions}}/{{tripInfo.companionCount}})</view>
      <view class="members-list">
        <view class="member-item" wx:for="{{companions}}" wx:key="id">
          <image class="member-avatar" src="{{item.avatar}}" mode="aspectFill" />
          <view class="member-info">
            <text class="member-name">{{item.name}}</text>
            <text class="member-role" wx:if="{{item.isCreator}}">åˆ›å»ºè€…</text>
          </view>
        </view>
        
        <!-- ç©ºä½æ˜¾ç¤º -->
        <view class="empty-slots" wx:if="{{tripInfo.currentCompanions < tripInfo.companionCount}}">
          <view class="empty-slot" wx:for="{{tripInfo.companionCount - tripInfo.currentCompanions}}" wx:key="*this">
            <text class="empty-icon">+</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ å…¥æŒ‰é’® -->
    <view class="action-section" wx:if="{{!isJoined && tripInfo.currentCompanions < tripInfo.companionCount}}">
      <button class="join-btn" bindtap="joinTrip">åŠ å…¥è¡Œç¨‹</button>
    </view>

    <!-- å·²åŠ å…¥çŠ¶æ€ -->
    <view class="joined-status" wx:if="{{isJoined}}">
      <text class="joined-text">âœ… å·²æˆåŠŸåŠ å…¥è¡Œç¨‹</text>
    </view>
  </view>

  <!-- åŠ å…¥ç¡®è®¤å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showJoinModal}}" bindtap="cancelJoin">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç¡®è®¤åŠ å…¥</text>
      </view>
      <view class="modal-body">
        <text class="modal-text">ç¡®å®šè¦åŠ å…¥è¿™ä¸ªæ—…è¡Œè®¡åˆ’å—ï¼Ÿ</text>
        <view class="trip-summary">
          <text class="summary-item">ç›®çš„åœ°ï¼š{{tripInfo.destination}}</text>
          <text class="summary-item">æ—¶é•¿ï¼š{{tripInfo.duration}}</text>
          <text class="summary-item">æ—¶é—´ï¼š{{tripInfo.startDate}} - {{tripInfo.endDate}}</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="cancelJoin">å–æ¶ˆ</button>
      </view>
      <view class="confirm-section">
        <button class="btn confirm-update" bindtap="confirmJoin">
          <view class="check-icon">âœ“</view>
          ç¡®è®¤æäº¤
        </button>
      </view>
    </view>
  </view>
</view> 