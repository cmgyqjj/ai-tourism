<view class="trip-detail-container">
  <!-- é¡¶éƒ¨é€€å‡ºæŒ‰é’® -->
  <view class="back-button" bindtap="goBack">
    <text class="back-icon">â†</text>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- åœ°å›¾åŒºåŸŸ - å å±å¹•1/3 -->
    <view class="map-section">
      <map 
        id="tripMap"
        class="trip-map"
        longitude="{{mapCenter.longitude}}"
        latitude="{{mapCenter.latitude}}"
        scale="{{mapScale}}"
        markers="{{mapMarkers}}"
        polyline="{{mapPolyline}}"
        show-location="true"
        bindmarkertap="onMarkerTap"
        bindregionchange="onRegionChange">
      </map>
    </view>

    <!-- è¡Œç¨‹æ ‡é¢˜åŒºåŸŸ - ç§»åŠ¨åˆ°åœ°å›¾ä¸‹é¢ -->
    <view class="trip-header">
      <view class="trip-title">
        <text class="title-text">å›¢é˜Ÿï¼š{{tripTitle}}</text>
        <view class="trip-duration" bindtap="viewTripDetails">
          <text class="duration-text">{{tripDuration}}</text>
          <text class="arrow">></text>
        </view>
      </view>
      <view class="participants">
        <view class="participant-avatar" wx:for="{{participants}}" wx:key="index">
          <image class="avatar" src="{{item.avatar}}" mode="aspectFill"></image>
          <view class="checkmark" wx:if="{{item.isCurrentUser}}">âœ“</view>
        </view>
        <view class="more-participants" wx:if="{{participants.length > 3}}">
          <text class="more-text">+{{participants.length - 3}}</text>
        </view>
      </view>
    </view>

    <!-- è¡Œç¨‹å†…å®¹åŒºåŸŸ - å å±å¹•2/3 -->
    <view class="trip-content">
      <!-- å·¦ä¾§æ—¥æœŸåˆ—è¡¨ -->
      <view class="date-list">
        <scroll-view class="date-scroll" scroll-y="true">
          <view class="date-item {{selectedDay === item.day ? 'active' : ''}}" 
                wx:for="{{tripDays}}" 
                wx:key="day"
                bindtap="selectDay"
                data-day="{{item.day}}">
            <view class="date-icon">
              <text class="day-number">{{item.day}}</text>
              <text class="weather-icon">{{item.weather}}</text>
            </view>
            <view class="date-info">
              <text class="date-text">{{item.date}}</text>
              <text class="route-text">{{item.route}}</text>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- å³ä¾§è¡Œç¨‹è¯¦æƒ… -->
      <scroll-view class="trip-details" scroll-y="true">
        <view class="day-header">
          <text class="day-title">ç¬¬{{selectedDay}}å¤© | {{currentDayInfo.route}}</text>
        </view>

        <!-- èˆªç­ä¿¡æ¯ -->
        <view class="detail-section" wx:if="{{currentDayInfo.flight}}">
          <view class="section-header">
            <text class="section-title">èˆªç­ä¿¡æ¯</text>
          </view>
          <view class="section-content">
            <text class="flight-info">{{currentDayInfo.flight}}</text>
          </view>
        </view>

        <!-- ä½å®¿å»ºè®® -->
        <view class="detail-section">
          <view class="section-header">
            <text class="section-title">ä½å®¿å»ºè®®</text>
            <text class="expand-icon" bindtap="toggleAccommodation">â–¼</text>
          </view>
          <view class="section-content">
            <text class="accommodation-info">{{currentDayInfo.accommodation}}</text>
          </view>
        </view>

        <!-- ç¾é£Ÿæ¨è -->
        <view class="detail-section" wx:for="{{currentDayInfo.food}}" wx:key="index">
          <view class="section-header">
            <view class="category-icon food-icon">ğŸ½ï¸</view>
            <text class="category-label">ç¾é£Ÿ</text>
          </view>
          <view class="section-content">
            <view class="item-card">
              <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
              <view class="item-info">
                <text class="item-name">{{item.name}}</text>
                <text class="item-price">äººå‡: Â¥{{item.price}}</text>
                <view class="item-distance" bindtap="navigateToLocation" data-location="{{item.location}}">
                  <text class="distance-text">{{item.distance}}å…¬é‡ŒÂ·{{item.time}}åˆ†é’Ÿ</text>
                  <text class="navigate-arrow">></text>
                </view>
              </view>
              <view class="item-menu" bindtap="showItemMenu" data-index="{{index}}">
                <text class="menu-icon">â˜°</text>
              </view>
            </view>
          </view>
        </view>

        <!-- æ™¯ç‚¹æ¨è -->
        <view class="detail-section" wx:for="{{currentDayInfo.attractions}}" wx:key="index">
          <view class="section-header">
            <view class="category-icon attraction-icon">ğŸ”ï¸</view>
            <text class="category-label">æ™¯ç‚¹</text>
          </view>
          <view class="section-content">
            <view class="item-card">
              <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
              <view class="item-info">
                <text class="item-number">{{index + 1}}.{{item.name}}</text>
                <text class="item-desc">{{item.description}}</text>
                <view class="item-distance" bindtap="navigateToLocation" data-location="{{item.location}}">
                  <text class="distance-text">{{item.distance}}å…¬é‡ŒÂ·{{item.time}}åˆ†é’Ÿ</text>
                  <text class="navigate-arrow">></text>
                </view>
              </view>
              <view class="item-menu" bindtap="showItemMenu" data-index="{{index}}">
                <text class="menu-icon">â˜°</text>
              </view>
            </view>
          </view>
        </view>

        <!-- ä½å®¿æ¨è -->
        <view class="detail-section" wx:for="{{currentDayInfo.hotels}}" wx:key="index">
          <view class="section-header">
            <view class="category-icon hotel-icon">ğŸ›ï¸</view>
            <text class="category-label">ä½å®¿æ¨è</text>
          </view>
          <view class="section-content">
            <view class="item-card">
              <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
              <view class="item-info">
                <text class="item-name">{{item.name}}</text>
                <text class="item-price">{{item.nights}}æ™š:Â¥{{item.price}}</text>
              </view>
              <view class="item-menu" bindtap="showItemMenu" data-index="{{index}}">
                <text class="menu-icon">â˜°</text>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- ä¾§è¾¹æ  -->
  <view class="sidebar {{sidebarOpen ? 'open' : ''}}">
    <!-- å†…å±‚èƒŒæ™¯å›¾ç‰‡ -->
    <image class="sidebar-bg" src="/images/travel-guide/sidebar1.png" mode="aspectFit"></image>
    
    <!-- å››ä¸ªåŠŸèƒ½æŒ‰é’®ï¼Œè¦†ç›–åœ¨å›¾ç‰‡ä¸Šå¯¹åº”çš„åŠŸèƒ½åŒºåŸŸ -->
    <view class="sidebar-btn route-optimization" bindtap="onRouteOptimization"></view>
    <view class="sidebar-btn strategy-pk" bindtap="onStrategyPK"></view>
    <view class="sidebar-btn team-strategy" bindtap="onTeamStrategy"></view>
    <view class="sidebar-btn share-friends" bindtap="onShareFriends"></view>
  </view>

  <!-- åŠ å·æŒ‰é’® -->
  <view class="add-button" bindtap="toggleSidebar">
    <text class="add-icon">+</text>
  </view>

  <!-- ä¾§è¾¹æ é®ç½© -->
  <view class="sidebar-overlay {{sidebarOpen ? 'show' : ''}}" bindtap="toggleSidebar"></view>
</view>
