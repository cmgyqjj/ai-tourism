<view class="trip-detail-container">
  <!-- é¡¶éƒ¨é€€å‡ºæŒ‰é’® -->
  <view class="back-btn" bindtap="goBack">
    <text class="back-arrow">â€¹</text>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- åœ°å›¾åŒºåŸŸ - å å±å¹•1/3 -->
    <view class="map-section">
      <map 
        id="tripMap"
        class="trip-map"
        longitude="{{mapCenter.longitude}}"
        latitude="{{mapCenter.latitude}}"
        scale="{{mapScale}}"
        markers="{{mapMarkers}}"
        polyline="{{mapPolyline}}"
        show-location="true"
        bindmarkertap="onMarkerTap"
        bindregionchange="onRegionChange"
        bindload="onMapLoad">
      </map>
    </view>
  </view>
  
  <view class="trip-content-container">
    <!-- è¡Œç¨‹æ ‡é¢˜åŒºåŸŸ - ç§»åŠ¨åˆ°åœ°å›¾ä¸‹é¢ -->
    <view class="trip-header">
      <view class="trip-title">
        <text class="title-text">å›¢é˜Ÿï¼š{{tripTitle}}</text>
        <view class="trip-duration" bindtap="viewTripDetails">
          <text class="duration-text">{{tripDuration}}</text>
          <text class="arrow">></text>
        </view>
      </view>
      <view class="participants">
        <view class="participant-avatar" wx:for="{{participants}}" wx:key="index">
          <image class="avatar" src="{{item.avatar}}" mode="aspectFill"></image>
          <view class="checkmark" wx:if="{{item.isCurrentUser}}">âœ“</view>
        </view>
        <view class="more-participants" wx:if="{{participants.length > 3}}">
          <text class="more-text">+{{participants.length - 3}}</text>
        </view>
      </view>
    </view>

    <!-- è¡Œç¨‹å†…å®¹åŒºåŸŸ - å å‰©ä½™ç©ºé—´ -->
    <view class="trip-content">
      <!-- å·¦ä¾§æ—¥æœŸåˆ—è¡¨ -->
      <view class="date-list">
        <scroll-view class="date-scroll" scroll-y="true">
          <view class="date-item {{selectedDay === item.day ? 'active' : ''}}" 
                wx:for="{{tripDays}}" 
                wx:key="day"
                bindtap="selectDay"
                data-day="{{item.day}}">
            <!-- é¡¶éƒ¨è¡Œï¼šæ—¥å†å›¾æ ‡ + æ—¥æœŸæ•°å­— + å¤©æ°”å›¾æ ‡ -->
            <view class="date-top-row">
              <image class="calendar-icon" src="/images/calendar.png" mode="aspectFit"></image>
              <text class="day-number">{{item.day}}</text>
              <text class="weather-icon">{{item.weather}}</text>
            </view>
            <!-- ä¸­é—´è¡Œï¼šæ—¥æœŸæ–‡æœ¬ -->
            <view class="date-middle-row">
              <text class="date-text">{{item.date}}</text>
            </view>
            <!-- åº•éƒ¨è¡Œï¼šè·¯çº¿æ–‡æœ¬ -->
            <view class="date-bottom-row">
              <text class="route-text">{{item.route}}</text>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- å³ä¾§è¡Œç¨‹è¯¦æƒ… -->
      <scroll-view class="trip-details" scroll-y="true">
        <!-- è¡Œç¨‹ä¿¡æ¯å®¹å™¨ -->
        <view class="trip-info-container">
          <view class="day-header">
            <text class="day-title">ç¬¬{{selectedDay}}å¤© | {{currentDayInfo.route}}</text>
          </view>

          <!-- èˆªç­ä¿¡æ¯ -->
          <view class="detail-section" wx:if="{{currentDayInfo.flight}}">
            <view class="section-header">
              <text class="section-title">èˆªç­ä¿¡æ¯</text>
              <view class="section-content">
                <text class="flight-info">{{currentDayInfo.flight}}</text>
              </view>
            </view>
          </view>

          <!-- ä½å®¿å»ºè®® -->
          <view class="detail-section">
            <view class="section-header">
              <text class="section-title">ä½å®¿å»ºè®®</text>
              <view class="section-content">
                <text class="accommodation-info">{{currentDayInfo.accommodation}}</text>
              </view>
            </view>
          </view>
     

                 <!-- åŠ¨æ€æ¸²æŸ“æ‰€æœ‰è¡Œç¨‹é¡¹ç›® -->
         <view class="detail-section" wx:for="{{currentDayInfo.items}}" wx:key="index">
           <view class="item-card">
             <!-- ä¸ŠåŠéƒ¨åˆ†ï¼šä¸»å†…å®¹åŒº -->
             <view class="item-main-content">
               <!-- å·¦ä¾§å›¾ç‰‡ -->
               <view class="item-image-container">
                 <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
               </view>

               <!-- ä¸­é—´æ–‡æœ¬ä¿¡æ¯ -->
               <view class="item-info">
                 <!-- é¡¶éƒ¨ï¼šåˆ†ç±»æ ‡é¢˜ -->
                 <view class="category-header">
                   <view class="category-icon {{item.type}}-icon" wx:if="{{item.type === 'food'}}">ğŸ½ï¸</view>
                   <view class="category-icon {{item.type}}-icon" wx:elif="{{item.type === 'attraction'}}">ğŸ”ï¸</view>
                   <view class="category-icon {{item.type}}-icon" wx:elif="{{item.type === 'hotel'}}">ğŸ›ï¸</view>
                   <view class="category-icon {{item.type}}-icon" wx:elif="{{item.type === 'checkin'}}">ğŸ“¸</view>
                   <view class="category-icon {{item.type}}-icon" wx:else>ğŸ“</view>
                 </view>
                 <text class="category-label" wx:if="{{item.type === 'food'}}">ç¾é£Ÿ</text>
                 <text class="category-label" wx:elif="{{item.type === 'attraction'}}">æ™¯ç‚¹</text>
                 <text class="category-label" wx:elif="{{item.type === 'hotel'}}">ä½å®¿æ¨è</text>
                 <text class="category-label" wx:elif="{{item.type === 'checkin'}}">æ‰“å¡ç‚¹</text>
                 <text class="category-label" wx:else>{{item.title}}</text>
               </view>
           
               <!-- ä¸­é—´ï¼šåç§° -->
               <text class="item-name" wx:if="{{item.type === 'food' || item.type === 'hotel'}}">{{item.name}}</text>
               <text class="item-number" wx:elif="{{item.type === 'attraction'}}">{{index + 1}}.{{item.name}}</text>
               <text class="item-name" wx:else>{{item.title}}</text>
               
               <!-- åº•éƒ¨ï¼šæè¿°ä¿¡æ¯ -->
               <text class="item-price" wx:if="{{item.type === 'food'}}">äººå‡: Â¥{{item.price}}</text>
               <text class="item-price" wx:elif="{{item.type === 'hotel'}}">{{item.nights}}æ™š:Â¥{{item.price}}</text>
               <text class="item-desc" wx:elif="{{item.type === 'attraction'}}">{{item.description}}</text>
               <text class="item-desc" wx:elif="{{item.type === 'checkin'}}">{{item.content}}</text>
             </view>

             <!-- å³ä¸Šè§’èœå•æŒ‰é’® -->
             <view class="item-menu" bindtap="showItemMenu" data-index="{{index}}">
               <text class="menu-icon">â˜°</text>
             </view>
           </view>

           <!-- ä¸‹åŠéƒ¨åˆ†ï¼šåº•éƒ¨ä¿¡æ¯åŒº -->
           <view class="item-bottom-info" bindtap="navigateToLocation" data-location="{{item.location}}">
             <image class="car-icon" src="/images/car.png" mode="aspectFit"></image>
             <text class="distance-text">{{item.distance}}å…¬é‡ŒÂ·{{item.time}}åˆ†é’Ÿ<text class="navigate-arrow">></text></text>
           </view>
         </view>
       </view>
      </scroll-view>
    </view>
  </view>

  <!-- ä¾§è¾¹æ  -->
  <view class="sidebar {{sidebarOpen ? 'open' : ''}}">
    <!-- å†…å±‚èƒŒæ™¯å›¾ç‰‡ -->
    <image class="sidebar-bg" src="/images/travel-guide/sidebar1.png" mode="aspectFit"></image>
    
    <!-- å››ä¸ªåŠŸèƒ½æŒ‰é’®ï¼Œè¦†ç›–åœ¨å›¾ç‰‡ä¸Šå¯¹åº”çš„åŠŸèƒ½åŒºåŸŸ -->
    <view class="sidebar-btn route-optimization" bindtap="onRouteOptimization"></view>
    <view class="sidebar-btn strategy-pk" bindtap="onStrategyPK"></view>
    <view class="sidebar-btn team-strategy" bindtap="onTeamStrategy"></view>
    <view class="sidebar-btn share-friends" bindtap="onShareFriends"></view>
  </view>

  <!-- åŠ å·æŒ‰é’® -->
  <view class="add-button" bindtap="toggleSidebar">
    <text class="add-icon">+</text>
  </view>

  <!-- ä¾§è¾¹æ é®ç½© -->
  <view class="sidebar-overlay {{sidebarOpen ? 'show' : ''}}" bindtap="toggleSidebar"></view>
</view>
