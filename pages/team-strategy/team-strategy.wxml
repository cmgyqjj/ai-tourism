<view class="trip-detail-container">
  <!-- 顶部退出按钮 -->
  <view class="back-btn" bindtap="goBack">
    <text class="back-arrow">‹</text>
  </view>

  <!-- 主要内容区域 -->
  <view class="main-content">
    <!-- 地图区域 - 占屏幕1/3 -->
    <view class="map-section">
      <map 
        id="tripMap"
        class="trip-map"
        longitude="{{mapCenter.longitude}}"
        latitude="{{mapCenter.latitude}}"
        scale="{{mapScale}}"
        markers="{{mapMarkers}}"
        polyline="{{mapPolyline}}"
        show-location="true"
        bindmarkertap="onMarkerTap"
        bindregionchange="onRegionChange"
        bindload="onMapLoad">
      </map>
    </view>
  </view>
  
  <view class="trip-content-container">
    <!-- 行程标题区域 - 移动到地图下面 -->
    <view class="trip-header">
      <view class="trip-title">
        <text class="title-text">团队：{{tripTitle}}</text>
        <view class="trip-duration" bindtap="viewTripDetails">
          <text class="duration-text">{{tripDuration}}</text>
          <text class="arrow">></text>
        </view>
      </view>
      <view class="participants">
        <view class="participant-avatar" wx:for="{{participants}}" wx:key="index">
          <image class="avatar" src="{{item.avatar}}" mode="aspectFill"></image>
          <view class="checkmark" wx:if="{{item.isCurrentUser}}">✓</view>
        </view>
        <view class="more-participants" wx:if="{{participants.length > 3}}">
          <text class="more-text">+{{participants.length - 3}}</text>
        </view>
      </view>
    </view>

    <!-- 行程内容区域 - 占剩余空间 -->
    <view class="trip-content">
      <!-- 左侧日期列表 -->
      <view class="date-list">
        <scroll-view class="date-scroll" scroll-y="true">
          <view class="date-item {{selectedDay === item.day ? 'active' : ''}}" 
                wx:for="{{tripDays}}" 
                wx:key="day"
                bindtap="selectDay"
                data-day="{{item.day}}">
            <!-- 顶部行：日历图标 + 日期数字 + 天气图标 -->
            <view class="date-top-row">
              <image class="calendar-icon" src="/images/calendar.png" mode="aspectFit"></image>
              <text class="day-number">{{item.day}}</text>
              <text class="weather-icon">{{item.weather}}</text>
            </view>
            <!-- 中间行：日期文本 -->
            <view class="date-middle-row">
              <text class="date-text">{{item.date}}</text>
            </view>
            <!-- 底部行：路线文本 -->
            <view class="date-bottom-row">
              <text class="route-text">{{item.route}}</text>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- 右侧行程详情 -->
      <scroll-view class="trip-details" scroll-y="true">
        <!-- 行程信息容器 -->
        <view class="trip-info-container">
          <view class="day-header">
            <text class="day-title">第{{selectedDay}}天 | {{currentDayInfo.route}}</text>
          </view>

          <!-- 航班信息 -->
          <view class="detail-section" wx:if="{{currentDayInfo.flight}}">
            <view class="section-header">
              <text class="section-title">航班信息</text>
              <view class="section-content">
                <text class="flight-info">{{currentDayInfo.flight}}</text>
              </view>
            </view>
          </view>

          <!-- 住宿建议 -->
          <view class="detail-section">
            <view class="section-header">
              <text class="section-title">住宿建议</text>
              <view class="section-content">
                <text class="accommodation-info">{{currentDayInfo.accommodation}}</text>
              </view>
            </view>
          </view>
     

                 <!-- 动态渲染所有行程项目 -->
         <view class="detail-section" wx:for="{{currentDayInfo.items}}" wx:key="index">
           <view class="item-card">
             <!-- 上半部分：主内容区 -->
             <view class="item-main-content">
               <!-- 左侧图片 -->
               <view class="item-image-container">
                 <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
               </view>

               <!-- 中间文本信息 -->
               <view class="item-info">
                 <!-- 顶部：分类标题 -->
                 <view class="category-header">
                   <view class="category-icon {{item.type}}-icon" wx:if="{{item.type === 'food'}}">🍽️</view>
                   <view class="category-icon {{item.type}}-icon" wx:elif="{{item.type === 'attraction'}}">🏔️</view>
                   <view class="category-icon {{item.type}}-icon" wx:elif="{{item.type === 'hotel'}}">🛏️</view>
                   <view class="category-icon {{item.type}}-icon" wx:elif="{{item.type === 'checkin'}}">📸</view>
                   <view class="category-icon {{item.type}}-icon" wx:else>📍</view>
                 </view>
                 <text class="category-label" wx:if="{{item.type === 'food'}}">美食</text>
                 <text class="category-label" wx:elif="{{item.type === 'attraction'}}">景点</text>
                 <text class="category-label" wx:elif="{{item.type === 'hotel'}}">住宿推荐</text>
                 <text class="category-label" wx:elif="{{item.type === 'checkin'}}">打卡点</text>
                 <text class="category-label" wx:else>{{item.title}}</text>
               </view>
           
               <!-- 中间：名称 -->
               <text class="item-name" wx:if="{{item.type === 'food' || item.type === 'hotel'}}">{{item.name}}</text>
               <text class="item-number" wx:elif="{{item.type === 'attraction'}}">{{index + 1}}.{{item.name}}</text>
               <text class="item-name" wx:else>{{item.title}}</text>
               
               <!-- 底部：描述信息 -->
               <text class="item-price" wx:if="{{item.type === 'food'}}">人均: ¥{{item.price}}</text>
               <text class="item-price" wx:elif="{{item.type === 'hotel'}}">{{item.nights}}晚:¥{{item.price}}</text>
               <text class="item-desc" wx:elif="{{item.type === 'attraction'}}">{{item.description}}</text>
               <text class="item-desc" wx:elif="{{item.type === 'checkin'}}">{{item.content}}</text>
             </view>

             <!-- 右上角菜单按钮 -->
             <view class="item-menu" bindtap="showItemMenu" data-index="{{index}}">
               <text class="menu-icon">☰</text>
             </view>
           </view>

           <!-- 下半部分：底部信息区 -->
           <view class="item-bottom-info" bindtap="navigateToLocation" data-location="{{item.location}}">
             <image class="car-icon" src="/images/car.png" mode="aspectFit"></image>
             <text class="distance-text">{{item.distance}}公里·{{item.time}}分钟<text class="navigate-arrow">></text></text>
           </view>
         </view>
       </view>
      </scroll-view>
    </view>
  </view>

  <!-- 侧边栏 -->
  <view class="sidebar {{sidebarOpen ? 'open' : ''}}">
    <!-- 内层背景图片 -->
    <image class="sidebar-bg" src="/images/travel-guide/sidebar1.png" mode="aspectFit"></image>
    
    <!-- 四个功能按钮，覆盖在图片上对应的功能区域 -->
    <view class="sidebar-btn route-optimization" bindtap="onRouteOptimization"></view>
    <view class="sidebar-btn strategy-pk" bindtap="onStrategyPK"></view>
    <view class="sidebar-btn team-strategy" bindtap="onTeamStrategy"></view>
    <view class="sidebar-btn share-friends" bindtap="onShareFriends"></view>
  </view>

  <!-- 加号按钮 -->
  <view class="add-button" bindtap="toggleSidebar">
    <text class="add-icon">+</text>
  </view>

  <!-- 侧边栏遮罩 -->
  <view class="sidebar-overlay {{sidebarOpen ? 'show' : ''}}" bindtap="toggleSidebar"></view>
</view>
